<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz PSG - Ma Passion PSG</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.20/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./src/style.css" /> 
    <link rel="icon" href="/psg.jpg" /> 
    <style>
      .scroll-mt-custom { scroll-margin-top: 80px; }
      .card.shadow-xl.bg-white,
      .card.shadow-xl.bg-gray-50, 
      #histoire.bg-white.p-6.rounded-2xl.shadow-xl,
      #histoire-content.bg-gray-50.p-6.rounded-2xl.shadow-xl,
      #quiz-card { /* S'applique aux cartes du quiz */
        border: 2px solid #002A5E; 
      }
      .navbar .menu-horizontal li a, .navbar .dropdown-content li a { transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; }
      .navbar .menu-horizontal li a:hover { background-color: rgba(255, 255, 255, 0.1); color: #DA291C; }
      .navbar .dropdown-content li a:hover { background-color: #003A70; color: #FFFFFF; }

      /* Améliorations visuelles Quiz */
      .quiz-question-text {
        font-size: 1.15rem; line-height: 1.7rem; font-weight: 600; margin-bottom: 0.75rem;
      }
      .quiz-option label {
        display: flex; align-items: center; padding: 0.85rem 1rem; 
        border: 1px solid #d1d5db; border-radius: 0.5rem; cursor: pointer;
        transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, transform 0.1s ease;
      }
      .quiz-option label:hover { /* Fond de la case au survol */
        background-color: #e9eef3; /* Un gris-bleu très clair */
        border-color: #9ca3af; 
        transform: translateY(-1px);
      }
      .quiz-option input[type="radio"] { /* Style du rond */
        margin-right: 0.85rem;
        /* La taille par défaut (en enlevant radio-sm) est déjà bien. */
        /* On va customiser la couleur du check avec radio-primary et le CSS ci-dessous */
      }
      .radio-primary:checked { /* Couleur du rond coché (sera PSG Rouge) */
          background-color: #DA291C;
          border-color: #DA291C;
          --chkbg: white; /* Couleur de la puce interne en DaisyUI */
      }
      .radio-primary:checked:hover {
          background-color: #C52010;
          border-color: #C52010;
      }
      .quiz-option input[type="radio"]:checked + span { /* Style du texte de l'option cochée */
        font-weight: 700; 
        color: #002A5E; 
      }

      .feedback-item { border-left-width: 4px; padding: 0.75rem 1rem; }
      .feedback-item.correct { border-left-color: #16a34a; background-color: #f0fdf4; }
      .feedback-item.incorrect { border-left-color: #dc2626; background-color: #fef2f2; }
      .feedback-icon { width: 1.25rem; height: 1.25rem; margin-right: 0.5rem; display: inline-block; vertical-align: middle; }

      /* Animations de score */
      #overall-feedback-container { position: relative; overflow: hidden; min-height: 50px; /* Pour que les confettis aient de la place */}
      .confetti-piece {
        position: absolute;
        width: 8px;
        height: 12px;
        opacity: 0;
        will-change: transform, opacity;
        animation-timing-function: linear; /* Fall should be linear for better spread */
      }
      @keyframes confetti-fall-and-sway {
        0% { transform: translateY(-20vh) translateX(0px) rotate(0deg); opacity: 1; }
        100% { transform: translateY(20vh) translateX(var(--sway-amount)) rotate(720deg); opacity: 0; }
      }

      @keyframes pulse-feedback {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.08); }
      }
      .animate-pulse-feedback { animation: pulse-feedback 0.8s ease-in-out 2; }

      @keyframes shake-encouraging {
        0%, 100% { transform: translateX(0) rotate(0deg); }
        20% { transform: translateX(-4px) rotate(-1deg); }
        40% { transform: translateX(4px) rotate(1deg); }
        60% { transform: translateX(-4px) rotate(-1deg); }
        80% { transform: translateX(4px) rotate(1deg); }
      }
      .animate-shake-encouraging { animation: shake-encouraging 0.7s cubic-bezier(.36,.07,.19,.97) both; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6 text-black bg-gray-100">

    <div class="max-w-4xl w-full space-y-6 bg-white shadow-2xl rounded-xl p-4 md:p-8 flex flex-col flex-grow">

        <header class="bg-[#002A5E] text-white shadow-lg rounded-lg mb-6">
            <div class="navbar px-2 sm:px-4 py-1">
                <div class="navbar-start">
                    <div class="dropdown">
                        <label tabindex="0" class="btn btn-ghost lg:hidden px-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" /></svg>
                        </label>
                        <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[50] p-2 shadow bg-[#002A5E] rounded-box w-52">
                            <li><a href="infos-club.html">Infos Club</a></li>
                            <li><a href="palmares.html">Palmarès</a></li>
                            <li><a href="histoire.html">Histoire</a></li>
                            <li><a href="effectif.html" class="active">Effectif</a></li>
                            <li><a href="quiz.html" class="font-bold bg-white bg-opacity-10">Quiz</a></li>
                            <li><a href="calculatrice.html">Calculatrice</a></li>
                        </ul>
                    </div>
                    <a class="btn btn-ghost normal-case text-lg sm:text-xl font-semibold hover:bg-transparent px-1 sm:px-2" href="index.html">Ma Passion PSG</a>
                </div>
                <div class="navbar-center hidden lg:flex">
                    <ul class="menu menu-horizontal items-center space-x-1">
                        <li><a href="infos-club.html" class="text-sm font-medium rounded-md px-3 py-2">Infos Club</a></li>
                        <li><a href="palmares.html" class="text-sm font-medium rounded-md px-3 py-2">Palmarès</a></li>
                        <li><a href="histoire.html" class="text-sm font-medium rounded-md px-3 py-2">Histoire</a></li>
                        <li><a href="effectif.html" class="text-sm font-medium rounded-md px-3 py-2 hover:bg-white hover:bg-opacity-10">Effectif</a></li>
                        <li><a href="quiz.html" class="text-sm font-medium rounded-md px-3 py-2 bg-white bg-opacity-10">Quiz</a></li>
                        <li><a href="calculatrice.html" class="text-sm font-medium rounded-md px-3 py-2">Calculatrice</a></li>
                    </ul>
                </div>
                <div class="navbar-end">
                    <a href="https://www.psg.fr" target="_blank" class="btn btn-sm bg-[#DA291C] hover:bg-[#C52010] border-none text-white">Site Officiel</a>
                </div>
            </div>
        </header>

        <main class="flex-grow space-y-8">
            <h1 class="text-3xl md:text-4xl font-bold text-center text-red-600">Quiz : Testez vos connaissances sur le PSG !</h1>

            <form id="quiz-form" class="space-y-10 card bg-gray-50 p-6 md:p-8 shadow-xl" id="quiz-card">
                <div id="questions-container" class="space-y-10">
                </div>
                <button type="submit" class="btn btn-primary w-full bg-[#004191] hover:bg-[#00306b] border-none text-white text-lg">Soumettre mes réponses</button>
            </form>

            <div id="result-container" class="text-left mt-8 hidden p-6 bg-gray-50 rounded-lg card shadow-xl" id="quiz-card">
                <h2 class="text-2xl font-bold text-center text-[#002A5E] mb-4">Vos Résultats Détaillés</h2>
                <p class="text-3xl font-bold my-2 text-center">Score final : <span id="score" class="text-red-600">0</span> / <span id="total-questions">0</span></p>
                <div id="overall-feedback-container" class="text-center mb-6 py-4"> 
                    <p id="overall-feedback" class="text-xl font-semibold"></p>
                </div>
                <div id="detailed-feedback-container" class="space-y-3">
                </div>
                <button id="retry-quiz" class="btn btn-secondary w-full mt-8 bg-red-600 hover:bg-red-700 border-none text-white">Rejouer le Quiz</button>
            </div>
        </main>

        <footer class="mt-auto pt-6 border-t border-gray-300">
            <div class="flex flex-wrap justify-center items-center gap-4">
                <a href="contact.html" class="btn bg-[#004191] text-white border-[#004191] hover:bg-[#00306b] hover:border-[#00306b]">Contact</a>
            </div>
            <p class="text-center text-sm text-gray-600 mt-6">
                © <script>document.write(new Date().getFullYear())</script> Ma Passion PSG. Tous droits réservés.
            </p>
        </footer>
    </div>

    <script>
        // ... (Variables JS existantes: quizForm, questionsContainer, etc.)
        const overallFeedbackContainer = document.getElementById('overall-feedback-container'); // Assurez-vous qu'il est bien défini
        // ... (Icônes SVG existantes)
        // ... (Tableau 'questions' existant avec 10 questions)
        const quizForm = document.getElementById('quiz-form');
        const questionsContainer = document.getElementById('questions-container');
        const resultContainer = document.getElementById('result-container');
        const scoreDisplay = document.getElementById('score');
        const totalQuestionsDisplay = document.getElementById('total-questions');
        const overallFeedbackDisplay = document.getElementById('overall-feedback');
        const detailedFeedbackContainer = document.getElementById('detailed-feedback-container');
        const retryButton = document.getElementById('retry-quiz');

        const correctIconSVG = `<svg class="feedback-icon text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>`;
        const incorrectIconSVG = `<svg class="feedback-icon text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>`;
        
        const questions = [
            { name: 'q1', text: '1. En quelle année le Paris Saint-Germain a-t-il été fondé ?', options: [{ value: '1968', text: '1968' },{ value: '1970', text: '1970' },{ value: '1972', text: '1972' }], answer: '1970' },
            { name: 'q2', text: "2. Quel joueur est le meilleur buteur de l'histoire du PSG (record établi avant mai 2025) ?", options: [{ value: 'cavani', text: 'Edinson Cavani' },{ value: 'mbappe', text: 'Kylian Mbappé' },{ value: 'ibra', text: 'Zlatan Ibrahimović' }], answer: 'mbappe' },
            { name: 'q3', text: "3. Contre quelle équipe le PSG a-t-il remporté la Coupe des Vainqueurs de Coupe en 1996 ?", options: [{ value: 'barca', text: 'FC Barcelone' },{ value: 'arsenal', text: 'Arsenal' },{ value: 'rapid', text: 'Rapid Vienne' }], answer: 'rapid' },
            { name: 'q4', text: "4. Quel est le nom du nouveau centre d'entraînement du PSG ?", options: [{ value: 'loges', text: 'Camp des Loges' },{ value: 'parc_training', text: 'Le Parc Training Center' },{ value: 'campus', text: 'Campus PSG' }], answer: 'campus' },
            { name: 'q5', text: "5. Combien de titres de Champion de France (Ligue 1) le PSG avait-il remporté à la fin de la saison 2023-2024 ?", options: [{ value: '10', text: '10' },{ value: '11', text: '11' },{ value: '12', text: '12' }], answer: '12' },
            { name: 'q6', text: "6. Quel entraîneur a mené le PSG à sa première finale de Ligue des Champions en 2020 ?", options: [{ value: 'ancelotti', text: 'Carlo Ancelotti' },{ value: 'blanc', text: 'Laurent Blanc' },{ value: 'tuchel', text: 'Thomas Tuchel' }], answer: 'tuchel' },
            { name: 'q7', text: "7. Quel joueur brésilien, portant le numéro 10, a enchanté le Parc des Princes au début des années 2000 avant de rejoindre le FC Barcelone ?", options: [{ value: 'kaka', text: 'Kaká' },{ value: 'ronaldinho', text: 'Ronaldinho' },{ value: 'robinho', text: 'Robinho' }], answer: 'ronaldinho' },
            { name: 'q8', text: "8. En quelle année Qatar Sports Investments (QSI) a-t-il racheté le PSG ?", options: [{ value: '2009', text: '2009' },{ value: '2011', text: '2011' },{ value: '2013', text: '2013' }], answer: '2011' },
            { name: 'q9', text: "9. Quel joueur a détenu le record du plus grand nombre de matchs joués pour le PSG pendant plus de 40 ans ?", options: [{ value: 'susic', text: 'Safet Sušić' },{ value: 'baratelli', text: 'Dominique Baratelli' },{ value: 'pilorget', text: 'Jean-Marc Pilorget' }], answer: 'pilorget' },
            { name: 'q10', text: "10. Quel est le principal rival du PSG en France, un match souvent appelé \"Le Classique\" ?", options: [{ value: 'marseille', text: 'Olympique de Marseille' },{ value: 'lyon', text: 'Olympique Lyonnais' },{ value: 'monaco', text: 'AS Monaco' }], answer: 'marseille' }
        ];

        function renderQuestions() {
            questionsContainer.innerHTML = ''; 
            questions.forEach((q) => {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';
                
                const questionTextEl = document.createElement('p');
                questionTextEl.className = 'quiz-question-text';
                questionTextEl.textContent = q.text;
                questionBlock.appendChild(questionTextEl);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-3 quiz-option';
                q.options.forEach(opt => {
                    const label = document.createElement('label'); // Le fond de la case (label) ne changera pas au cochage
                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = q.name;
                    radio.value = opt.value;
                    // Utilise radio-primary, qui sera stylé en rouge PSG par CSS quand coché
                    radio.className = 'radio radio-primary'; // Taille par défaut, plus grande que radio-sm
                    
                    const span = document.createElement('span');
                    span.textContent = ` ${opt.text}`;
                    
                    label.appendChild(radio);
                    label.appendChild(span);
                    optionsDiv.appendChild(label);
                });
                questionBlock.appendChild(optionsDiv);
                questionsContainer.appendChild(questionBlock);
            });
        }

        totalQuestionsDisplay.textContent = questions.length;

        function triggerConfetti() {
            const container = overallFeedbackContainer;
            // Nettoyer les anciens confettis s'il y en a
            container.querySelectorAll('.confetti-piece').forEach(el => el.remove());

            const confettiCount = 80;
            const colors = ['#DA291C', '#002A5E', '#FFFFFF']; // Rouge, Bleu, Blanc PSG

            for (let i = 0; i < confettiCount; i++) {
                const confettiPiece = document.createElement('div');
                confettiPiece.classList.add('confetti-piece');
                confettiPiece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Positionner au centre du conteneur de feedback global
                confettiPiece.style.left = '50%';
                confettiPiece.style.top = '50%';
                confettiPiece.style.transform = 'translate(-50%, -50%)'; // Centrer l'origine de la particule

                // Animation
                const duration = Math.random() * 1.5 + 2.5; // 2.5s à 4s
                const randomX = (Math.random() - 0.5) * 2 * 150; // Dispersion horizontale -150px à 150px
                const randomY = (Math.random() - 0.5) * 2 * 150; // Dispersion verticale
                const randomRotate = (Math.random() - 0.5) * 2 * 720; // Rotation
                
                // On applique l'animation via JS pour plus de contrôle sur les propriétés finales
                confettiPiece.animate([
                    { transform: `translate(-50%, -50%) rotate(0deg) scale(1)`, opacity: 1 },
                    { transform: `translate(calc(-50% + ${randomX}px), calc(-50% + ${randomY}px)) rotate(${randomRotate}deg) scale(0)`, opacity: 0 }
                ], {
                    duration: duration * 1000,
                    easing: 'cubic-bezier(0.1, 0.5, 0.2, 1)', // Courbe d'animation pour effet "jeté"
                    fill: 'forwards'
                });

                container.appendChild(confettiPiece);
                setTimeout(() => confettiPiece.remove(), duration * 1000);
            }
        }


        quizForm.addEventListener('submit', function(event) {
            event.preventDefault();
            let currentScore = 0;
            detailedFeedbackContainer.innerHTML = ''; 
            // Réinitialiser les classes d'animation sur le conteneur de feedback global
            overallFeedbackDisplay.className = 'text-xl font-semibold';


            questions.forEach((q) => {
                const selectedOptionValue = quizForm.elements[q.name].value;
                const selectedOptionObject = q.options.find(opt => opt.value === selectedOptionValue);
                const correctAnswerObject = q.options.find(opt => opt.value === q.answer);
                
                const feedbackItem = document.createElement('div');
                const qText = document.createElement('p');
                qText.className = 'font-semibold text-gray-800 text-base';
                qText.textContent = q.text;
                feedbackItem.appendChild(qText);

                const userAnswerP = document.createElement('p');
                userAnswerP.className = 'text-sm';
                const userAnswerDisplay = selectedOptionObject ? selectedOptionObject.text : 'Non répondu';
                
                if (selectedOptionValue === q.answer) {
                    currentScore++;
                    feedbackItem.className = 'feedback-item correct';
                    userAnswerP.innerHTML = `${correctIconSVG} Votre réponse : ${userAnswerDisplay}`;
                } else {
                    feedbackItem.className = 'feedback-item incorrect';
                    userAnswerP.innerHTML = `${incorrectIconSVG} Votre réponse : ${userAnswerDisplay}`;
                    const correctAnswerP = document.createElement('p');
                    correctAnswerP.className = 'text-sm text-blue-700 mt-1';
                    // Ajouter un peu d'espace pour aligner avec l'icône (approximatif)
                    correctAnswerP.innerHTML = `<span class="opacity-0">${incorrectIconSVG}</span> Bonne réponse : ${correctAnswerObject.text}`;
                    feedbackItem.appendChild(correctAnswerP);
                }
                feedbackItem.insertBefore(userAnswerP, feedbackItem.childNodes[1]);
                detailedFeedbackContainer.appendChild(feedbackItem);
            });

            scoreDisplay.textContent = currentScore;
            resultContainer.classList.remove('hidden');
            quizForm.classList.add('hidden');
            
            if (currentScore === questions.length) { // 10/10
                overallFeedbackDisplay.textContent = "SCORE PARFAIT ! MAGNIFIQUE !";
                overallFeedbackDisplay.classList.add('text-yellow-400'); // Couleur Or
                triggerConfetti(); // Déclencher le feu d'artifice/confettis
            } else if (currentScore === Math.floor(questions.length / 2) && questions.length % 2 === 0 || currentScore === Math.ceil(questions.length / 2) && questions.length % 2 !== 0 || currentScore === Math.floor(questions.length / 2) && questions.length % 2 !== 0) { // Score de 5/10 (ou moitié si impair)
                overallFeedbackDisplay.textContent = `Pile la moyenne (${currentScore}/${questions.length}) ! C'est bien !`;
                overallFeedbackDisplay.classList.add('text-blue-500', 'animate-pulse-feedback');
            } else if (currentScore === 0) { // 0/10
                 overallFeedbackDisplay.textContent = `0/${questions.length}. L'important c'est de participer (et d'apprendre !)`;
                 overallFeedbackDisplay.classList.add('text-orange-500', 'animate-shake-encouraging');
            } else if (currentScore >= Math.ceil(questions.length * 0.7)) {
                overallFeedbackDisplay.textContent = `Excellent score (${currentScore}/${questions.length}) ! Un vrai connaisseur !`;
                overallFeedbackDisplay.classList.add('text-green-600');
            } else {
                overallFeedbackDisplay.textContent = `Votre score : ${currentScore}/${questions.length}. Pas mal du tout !`;
                overallFeedbackDisplay.classList.add('text-[#002A5E]'); // Bleu PSG
            }
        });

        retryButton.addEventListener('click', function() {
            resultContainer.classList.add('hidden');
            quizForm.reset(); 
            renderQuestions(); 
            quizForm.classList.remove('hidden');
            scoreDisplay.textContent = '0'; 
            overallFeedbackDisplay.textContent = '';
            // Nettoyer les classes d'animation
            overallFeedbackDisplay.classList.remove('text-yellow-400', 'animate-tada-score', 'text-blue-500', 'animate-pulse-feedback', 'text-orange-500', 'animate-shake-encouraging', 'text-green-600', 'text-[#002A5E]');
             // Nettoyer les confettis restants
            overallFeedbackContainer.querySelectorAll('.confetti-piece').forEach(el => el.remove());
        });

        renderQuestions();
    </script>
</body>
</html>